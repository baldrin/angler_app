generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String
  phone         String?
  created_at    DateTime @default(now())
  favorites     favorites[]
  alerts        alerts[]
  alert_log     alert_log[]
}

model usgs_stations {
  site_id   String   @id
  name      String
  lat       Float
  lon       Float
  updated_at DateTime @updatedAt
  favorites favorites[]
  alerts    alerts[]
  station_cache station_cache[]
}

model favorites {
  id         Int      @id @default(autoincrement())
  user_id    Int
  site_id    String
  notes      String?
  created_at DateTime @default(now())

  users        users         @relation(fields: [user_id], references: [id])
  usgs_stations usgs_stations @relation(fields: [site_id], references: [site_id])

  @@unique([user_id, site_id])
}

model alerts {
  id               Int      @id @default(autoincrement())
  user_id          Int
  site_id          String
  parameter        String
  comparator       String
  value            Float
  enabled          Boolean  @default(true)
  last_triggered_at DateTime?
  created_at       DateTime @default(now())

  users        users         @relation(fields: [user_id], references: [id])
  usgs_stations usgs_stations @relation(fields: [site_id], references: [site_id])
  alert_log    alert_log[]
}

model alert_log {
  id          Int      @id @default(autoincrement())
  user_id     Int
  alert_id    Int
  site_id     String
  triggered_at DateTime @default(now())
  message     String

  users    users   @relation(fields: [user_id], references: [id])
  alerts   alerts  @relation(fields: [alert_id], references: [id])
}

model station_cache {
  id          Int      @id @default(autoincrement())
  site_id     String
  fetched_at  DateTime @default(now())
  discharge_cfs Float?
  gage_ft     Float?
  raw_json    Json?

  usgs_stations usgs_stations @relation(fields: [site_id], references: [site_id])
}
